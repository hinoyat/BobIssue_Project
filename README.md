# :green_salad: 밥이슈(Bobissue)
<img src="image/logo.png" height="100%" width="100%">

<!-- # :green_salad: 한줄 소개
현대인들의 효율적인 건강식을 권장하는 종합 솔루션 쇼핑몰 -->

# :green_salad: 프로젝트 개요
## :rocket: 프로젝트 소개
밥이슈(Bobissue) 프로젝트는 식단 관리 서비스를 기반한 건강식 쇼필몰로 현대인들이 보다 효율적으로 건강식을 접할 수 있는 종합 솔루션 쇼핑몰이다. 또한, 라이브 커머스 기능을 제공하며 판매자의 상품 판매 및 광고하며 소비자의 구매를 유도할 수 있는 기능 제공한다. 소비자의 성별, 나이 등을 기준을 통계 및 그래프를 제공하여 판매자가 소비자의 소비 패턴을 분석하여 판매 전략을 수립할 수 있도록 도움을 준다.


## :dart: 프로젝트 기획 배경

### :herb: 건강한 식단관리 필요성

- 만성 질환 예방 중요성 인식
- 올바른 영양 섭취의 필요성
- 다이어트 및 건강식에 대한 관심도 지속적 상승
- 건강한 생활습관 형성 욕구

### :fork_and_knife_with_plate: 맞춤형 식단 수요 증가

- 개인 건강데이터 저장 및 활용 증가
- 다양한 식단 요구사항 존재
- 편의성과 효율성 동시 추구

### :chart_with_upwards_trend: 온라인 식품 시장 성장

- 코로나 19로 인한 비대면 선호
- 신선식품 온라인 구매 증가
- MZ 세대의 온라인 쇼핑 선호
- 간편식 및 밀키트 시장 확대

## :warning: 문제점

### :mag: 개인화 부족

- 기존 식단 관리 서비스의 한계
- 쇼핑몰과의 분리로 효율성 낮은 경우 많음
    - 즉, 식단을 짜고 활용해보고 싶지만 시간이 없는 경우 직접 음식을 고르고 주문하고 기록하는 전과정이 오래 소요되고 비효율적.

### :clock3: 지속성 문제

- 단기적인 식단 관리
- 동기부여 요소 부족
- 사용자 이탈률 높음

## :pushpin: 사례

컬리? 식단 관리 서비스?

## :bulb: 서비스 해결방안

### :shopping_bags: 쇼핑몰 통합

- 식단과 쇼핑 연계
- 편리한 구매 경험
- 신선식품 제공
- 시간 절약 가능

### :link: 원스톱 솔루션

- 식단 계획부터 구매까지
- 한 플랫폼에서 해결
- 사용자 편의성 증대
- 통합 서비스 제공

## :key: 주요 기능 및 핵심 서비스

### :shopping_cart: 쇼핑몰

- 식재료 판매
- 건강식품 제공
- 맞춤형 상품 추천
- 편리한 구매 경험

### :movie_camera: 라이브 커머스

- 실시간 상품 소개
- 즉각적인 질의응답
- 특별 할인 혜택

### :green_salad: 식단 관리

- 개인화된 식단 관리
- 칼로리 및 영양 계산
- 식단 기록 및 레시피 공유
- 쇼핑몰 연계 식단 관리 및 즉시 주문

</br>
</br>

# :green_salad: 개발 환경

## :iphone: 프론트엔드


| 항목 | 기술 |
|------|------|
| **개발 환경** | ![Visual Studio Code](https://img.shields.io/badge/VS_Code-007ACC.svg?&style=for-the-badge&logo=visualstudiocode&logoColor=white) |
| **프로그래밍 언어** | ![JavaScript](https://img.shields.io/badge/JavaScript-F7DF1E.svg?&style=for-the-badge&logo=JavaScript&logoColor=black) |
| **빌드 도구** | ![Vite](https://img.shields.io/badge/Vite-646CFF.svg?&style=for-the-badge&logo=Vite&logoColor=white) |
| **프레임워크** | ![React](https://img.shields.io/badge/React-61DAFB.svg?&style=for-the-badge&logo=React&logoColor=black) |
| **상태 관리** | ![Redux](https://img.shields.io/badge/Redux-764ABC.svg?&style=for-the-badge&logo=Redux&logoColor=white) |
| **CSS 프레임워크** | ![Tailwind CSS](https://img.shields.io/badge/Tailwind_CSS-06B6D4.svg?&style=for-the-badge&logo=Tailwind-CSS&logoColor=white) |
| **인증/보안** | ![OAuth](https://img.shields.io/badge/OAuth-3A3A3A.svg?&style=for-the-badge&logo=OAuth&logoColor=white) |



## :computer: 백엔드

| 항목 | 기술 |
|------|------|
| **프로그래밍 언어** | ![Java](https://img.shields.io/badge/Java-007396.svg?&style=for-the-badge&logo=OpenJDK&logoColor=white) |
| **개발 환경** | ![IntelliJ IDEA](https://img.shields.io/badge/IntelliJ_IDEA-000000.svg?&style=for-the-badge&logo=IntelliJ-IDEA&logoColor=white) |
| **빌드 도구** | ![Gradle](https://img.shields.io/badge/Gradle-02303A.svg?&style=for-the-badge&logo=Gradle&logoColor=white) |
| **프레임워크** | ![Spring Boot](https://img.shields.io/badge/Spring_Boot-6DB33F.svg?&style=for-the-badge&logo=Spring-Boot&logoColor=white) |
| **보안** | ![Spring Security](https://img.shields.io/badge/Spring_Security-6DB33F.svg?&style=for-the-badge&logo=Spring-Security&logoColor=white) ![JWT](https://img.shields.io/badge/JWT-000000.svg?&style=for-the-badge&logo=JSON-Web-Tokens&logoColor=white) |


## :gear: 공통

| 항목 | 기술 |
|------|------|
| **형상 관리** | ![Git](https://img.shields.io/badge/Git-F05032.svg?&style=for-the-badge&logo=Git&logoColor=white) ![GitLab](https://img.shields.io/badge/GitLab-FC6D26.svg?&style=for-the-badge&logo=GitLab&logoColor=white) |
| **협업** | ![Notion](https://img.shields.io/badge/Notion-000000.svg?&style=for-the-badge&logo=Notion&logoColor=white) ![JIRA](https://img.shields.io/badge/JIRA-0052CC.svg?&style=for-the-badge&logo=JIRA&logoColor=white) |
| **데이터베이스** | ![MySQL](https://img.shields.io/badge/MySQL-4479A1.svg?&style=for-the-badge&logo=MySQL&logoColor=white) ![Redis](https://img.shields.io/badge/Redis-DC382D.svg?&style=for-the-badge&logo=Redis&logoColor=white) ![MongoDB](https://img.shields.io/badge/MongoDB-47A248.svg?&style=for-the-badge&logo=MongoDB&logoColor=white) ![ElasticSearch](https://img.shields.io/badge/Elastic_Search-005571.svg?&style=for-the-badge&logo=ElasticSearch&logoColor=white) |
| **커뮤니케이션** | ![Mattermost](https://img.shields.io/badge/Mattermost-0072C6.svg?&style=for-the-badge&logo=Mattermost&logoColor=white) |
| **배포** | ![Jenkins](https://img.shields.io/badge/Jenkins-D24939.svg?&style=for-the-badge&logo=Jenkins&logoColor=white) ![Docker](https://img.shields.io/badge/Docker-2496ED.svg?&style=for-the-badge&logo=Docker&logoColor=white) ![Nginx](https://img.shields.io/badge/Nginx-009639.svg?&style=for-the-badge&logo=Nginx&logoColor=white) |

</br>
</br>

# :green_salad: 요구사항 분석(기능 명세서)
## :bust_in_silhouette: 이용자

| 권한 | 대분류 | 중분류 | 소분류 | 설명 |
|------|--------|--------|--------|------|
| 이용자 | 1. 회원가입 | 1-1. 회원가입 |  | 필수: 아이디, 비밀번호, 이름, 주소, 닉네임, 전화, 이메일, 생년월일, 성별 <br> 동의: 이용약관, 개인정보 수집 및 이용 <br> 선택: 수신 동의, 사진 |
|  |  | 1-2. 소셜 회원가입 |  |  |
|  | 2. 로그인 | 2-1. 로그인 |  | 아이디 & 비밀번호 입력 후 로그인 |
|  |  | 2-2. 소셜 로그인 |  | 네이버, 카카오 간편 로그인 지원 |
|  |  | 2-3. 비밀번호 찾기 |  |  |
|  | 3. 로그아웃 |  |  |  |
|  | 4. 회원 등급 | 4-1. 등급 확인 |  | 구매 금액에 따른 포인트 적립 및 등급제 운영 |
|  | 5. 네비게이션바 | 5-1. 카테고리 | 5-1-1. 종류별 | 닭고기, 소고기/돼지고기, 김밥/도시락/볶음밥, 샐러드/과일 등 |
|  |  |  | 5-1-2. 목적별 | 간편식, 다이어트, 영양식, 벌크업 |
|  | 6. 라이브 커머스 | 6-1. 라이브 일정 보기 |  | 라이브 커머스 방송 리스트 표시 |
|  |  | 6-2. 라이브 시청 |  | 라이브 방송 시청 및 채팅 가능 |
|  | 7. 상품 조회 | 7-1. 상품 목록 |  | 상품 이미지, 이름, 가격 등 정보 조회 |
|  | 8. 상품 상세 | 8-1. 상품 상세정보 |  | 상품 설명, 영양성분, 판매자 정보 등 |
|  |  | 8-2. 상품 찜 | 8-2-1. 찜하기 | 마이페이지에서 확인 가능 |
|  | 9. 장바구니 | 9-1. 장바구니 목록 | 9-1-1. 상품 정보 조회 | 수량, 옵션 수정 및 삭제 가능 |
|  | 10. 결제 | 10-1. 배송지 | 10-1-1. 배송지 선택 | 기본 배송지 설정 가능 |
|  |  | 10-2. 결제 금액 | 10-2-1. 할인 쿠폰 | 관리자 발급 쿠폰 적용 가능 |
|  |  | 10-5. 결제 |  | 결제 API 호출 |
|  | 11. 마이페이지 | 11-1. 주문 목록 | 11-1-1. 주문 내역 조회 | 주문 기간 선택 및 상품 검색 가능 |
|  | 12. 고객센터 | 12-1. FAQ |  | 자주 묻는 질문 카테고리 제공 |
|  | 13. 레시피 | 13-1. 레시피 생성 | 13-1-1. 레시피 작성 | 레시피명, 시간, 방법 기입 |

## :convenience_store: 판매자

| 권한 | 대분류 | 중분류 | 소분류 | 설명 |
|------|--------|--------|--------|------|
| 판매자 | 1. 회원가입 | 1-1. 회원 가입 |  | 회원가입 유형: 사업자 전용 |
|  | 2. 로그인 | 2-1. 로그인 |  | 판매자는 소셜 로그인 불가 |
|  | 4. 판매자 페이지 | 4-1. 상품 목록 관리 | 4-1-1. 상품 정보 목록 조회 | 상품명, 가격, 상세설명, 재고 포함 |
|  |  | 4-2. 상품 관리 | 4-2-1. 상품 정보 등록 | 상품명, 가격, 재고, 할인 설정 가능 |
|  |  | 4-3. 주문/배송 관리 | 4-3-1. 주문 목록 조회 | 구매자의 배송 처리 목록 조회 |
|  |  |  | 4-3-2. 출고 관리 | 이용자 구매 상품 배송 |
|  |  | 4-4. 정산 | 4-4-1. 정산 조회 | 정산 금액 및 날짜 확인 가능 |
|  |  | 4-5. 판매자 정보 관리 | 4-5-1. 판매자 정보 조회 | 판매자 등급, 판매 내역 확인 |
|  | 5. 고객 관리 | 5-1. 1:1 문의 응대 | 5-1-1. 문의 조회 | 이용자 문의 목록 조회 및 상세 답변 |
|  | 6. 라이브 커머스 | 6-1. 라이브 신청하기 |  | 관리자에게 라이브 방송 신청 가능 |
|  | 7. 판매 통계 | 7-1. 판매 성과 조회 |  | 결제 금액 및 환불 현황 일별 분석 |
|  | 9. 레시피 | 9-1. 레시피 생성 | 9-1-1. 레시피 작성 | 레시피명, 시간, 방법 입력 |

## :cop: 관리자 

| 권한 | 대분류 | 중분류 | 소분류 | 설명 |
|------|--------|--------|--------|------|
| 관리자 | 1. 로그인/로그아웃 |  |  |  |
|  | 2. 일반 회원 관리 | 2-1. 회원 목록 조회 |  | 전체 회원 및 특정 회원 조회 |
|  |  | 2-2. 회원 상세 조회 | 2-2-1. 회원 정보 조회 | 개인정보 및 등급 조회 |
|  | 3. 판매자 회원 관리 | 3-1. 판매자 목록 조회 | 3-1-1. 전체 판매자 조회 | |
|  |  | 3-2. 판매자 상세 조회 | 3-2-1. 판매자 신청 조회 | 판매자가 상품 판매 신청한 목록 |
|  |  |  | 3-2-2. 판매자 정보 조회 | 해당 회사의 계정 수, 활동 내역, 판매 제품 등 |
|  |  |  | 3-2-3. 판매자 활성화 | 비활성화된 판매자 계정 활성화 |
|  | 4. 라이브 커머스 | 4-1. 라이브 시간표 관리 | 4-1-1. 라이브 신청받기 | 판매자가 신청한 라이브 관리 |
|  | 5. 컨텐츠 관리 | 5-1. 쿠폰 관리 | 5-1-1. 쿠폰 현황 조회 | 사이트 내 모든 쿠폰 조회 |
|  |  | 5-2. 화면 관리 | 5-2-1. 이벤트 배너 등록 | 이벤트 배너 생성 및 관리 |
|  | 6. CS 관리 | 6-1. 알림 관리 | 6-1-1. 알림 보내기 | 전체 및 개별 알림 전송 가능 |
|  |  | 6-2. 고객 센터 관리 | 6-2-1. 문의 조회 | 이용자 문의 내용 확인 |
|  |  | 6-3. 공지사항 관리 | 6-3-1. 공지사항 조회 | 이용자/판매자별 공지 구분 가능 |

</br>
</br>


# 📈 ERD
<img src="image/BobIssueERD.png" height="100%" width="100%">
</br>

# [🖥 화면설계서]
<img src="image/userPage.png" height="100%" width="100%">
<img src="image/sellerPage.png" height="100%" width="100%">
<img src="image/adminPage.png" height="100%" width="100%">
</br>

<!-- 

#  [📅 WBS](https://docs.google.com/spreadsheets/d/19pO974fKGKGOW3XLY8PIu9Kd5hFQFiLN8cf3-CNAI-o/edit?usp=sharing)
</br>



# [🖥 화면설계서](https://www.figma.com/file/J6p1dopme7dCpIH5zSnxHc/Catch?type=design&node-id=0%3A1&mode=design&t=OH7rpExEUxgtSPbR-1)
</br>

# [🎬API 명세 및 테스트 결과서](https://documenter.getpostman.com/view/32406846/2sA35LTyRZ)
</br>

# ⛏ 아키텍처 설계도
<img src=".github/Image/Catch-아키텍처.png" height="100%" width="100%">
</br>


# UI/UX 단위 결과서

<details>
<summary> <h2> 로그인 & 로그아웃 </h3> </summary>

<h3> 고객: 로그인 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/2be05d62-8230-4f3c-bc67-be698040c72c" height="100%" width="100%">
</br>

<h3> 고객: 로그아웃 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/ef05e457-a500-4431-8489-0a14a18e49aa" height="100%" width="100%">
</br>

</details>


<details>
<summary> <h2> 고객: 문의 게시글 </h3> </summary>

<h3> 고객: 마이페이지 → 나의 게시글 보기 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/84c1298f-3d77-4b10-99a4-224c32c5fad3" height="100%" width="100%">
</br>

<h3> 고객: 문의글 작성하기 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/6e5d7d10-514a-4a93-95b1-d7ca532f8015" height="100%" width="100%">
</br>

<h3> 고객: 문의글 수정하기 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/44cec826-9ad5-4579-b8b5-f8a814677c04" height="100%" width="100%">
</br>

<h3> 고객: 문의글 삭제하기 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/f06d9790-3231-47f7-a60a-7208ffdbdd86" height="100%" width="100%">
</br>

</details>



<details>
<summary> <h2> 관리자: 문의게시글 </h3> </summary>

<h3> 관리자: 대시보드(메인화면) </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/1578f984-b3ae-4f70-b7c1-7d9671c53f78" height="100%" width="100%">
</br>

<h3> 관리자: 문의게시글 리스트(검색) </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/63e91407-1932-40ab-a79f-c7d4de7f60b3" height="100%" width="100%">
</br>

<h3> 관리자: 게시글 상세보기 및 답변 달기 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/0450ac7d-be9b-4410-a58c-6591c03a8ff3" height="100%" width="100%">
</br>

<h3> 관리자: 게시글 답변 수정 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/cedd0d4b-27d6-4ed4-ae10-351c12d0c2a2" height="100%" width="100%">
</br>

<h3> 관리자: 게시글 답변 삭제 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/ab27b64b-33fc-4b06-81e4-71d90157972a" height="100%" width="100%">
</br>

</details>

<details>
<summary> <h2> 쿠폰 </h3> </summary>

<h3> 관리자: 쿠폰리스트 및 검색 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/75c840d5-aac0-4482-a728-4a0d2158ef39" height="100%" width="100%">
</br>

<h3> 관리자: 쿠폰생성 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/7c767138-d67c-4fc2-9a41-e043dc0a1769" height="100%" width="100%">
</br>

<h3> 고객: 쿠폰수령 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/4ff26c38-cee9-433f-98b7-383bde22e4b7" height="100%" width="100%">
</br>

<h3> 고객: 수령 가능 쿠폰 및 내 쿠폰 보기 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/a51ddba4-7726-4330-acff-a8e200815574" height="100%" width="100%">
</br>

<h3> 쿠폰 발행 및 알람 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/3471778f-dfda-492c-9d1a-aa5d15584099" height="100%" width="100%">
</br>

</details>


<details>
<summary> <h2> 관리자: 고객리스트 </h3> </summary>

<h3> 관리자: 고객리스트 검색 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/1d8f70d6-def3-44a9-8605-5a13d3394f74" height="100%" width="100%">
</br>

<h3> 관리자: 고객 상세보기, 메모, 활성화, 비활성화 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/45dbf2c9-46cc-4b5f-992d-3cc60ba248be" height="100%" width="100%">
</br>

</details>

<details>
<summary> <h2> 관리자: 회사 계정 관리 </h3> </summary>

<h3> 관리자: 회사 계정 검색 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/ea86d4c3-a85a-44bd-b46b-2b39162079f9" height="100%" width="100%">
</br>

<h3> 관리자: 회사 계정 생성 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/09f58a17-c684-4751-86e8-a816a77c018f" height="100%" width="100%">
</br>

<h3> 관리자: 회사 계정 수정, 계정 활성화, 비활성화 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/58584e76-5598-4fcd-873e-adbe4d3ba328" height="100%" width="100%">
</br>

</details>


<details>
<summary> <h2> 관리자: 이벤트 </h3> </summary>

<h3> 관리자: 이벤트 생성 </h3>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/788c2bd1-c6c5-45bf-b8eb-234d5c7c893f" height="100%" width="100%">
</br>

</details>


<details>
<summary> <h2> 접근 권한 및 페이지 없음 (404, 403) </h3> </summary>

<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/452f7462-eb5b-4c8b-a06e-90e0c5271089" height="100%" width="100%">
</br>

</details>


<details>
<summary> <h2> 관리자: 리스트 화면 페이징 처리 </h3> </summary>
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/088ec497-6511-47a9-b90b-fe4a7115a51b" height="100%" width="100%">
</br>

</details>

</br>



<h1> 📋CI/CD 계획서 </h1>

## 목표 및 범위:
- 모놀리식 CRM 서비스와 핵사고날 아키텍처로 설계된 event 모듈 및 SpringBatch로 구성된 배치서비스 들을 미니서비스아키텍처로 구성하고
  이를 안정적으로 배포해 쿠버네티스 컨테이너 오케이스트레이션을 통해 대규모 데이터 및 트래픽에 대비할 수 있도록 합니다.

## 환경 및 도구:
- CI/CD를 위해 사용할 환경과 도구
    - CI 도구: GithubAction, 
    - CD 도구: Docker, Kubernetes

## 저장소:
- 코드를 저장할 저장소와 브랜치 전략
    - 저장소: GitHub
    - 브랜치 전략: 각 Feature 브랜치를 dev에 머지하고, dev 서버를 통해 AWS에 배포한 후 안정적인 서비스가 가능할 때 main 브랜치에 머지 후 버전관리합니다.

## 빌드 및 자동화 스크립트:
- CI/CD 파이프라인을 구축하기 위한 빌드 스크립트와 자동화 스크립트
    - 빌드 스크립트: Gradle
    - 자동화 스크립트: GitHub Action Script

## 배포 전략:
-  쿠버네티스를 이용한 롤링 배포

### 단계:

1. **GitHub 저장소 체크아웃**:
  - GitHub 저장소를 체크아웃합니다.

2. **kubectl 설치**:
  - kubectl을 설치합니다.

3. **AWS 자격 증명 구성**:
  - AWS 자격 증명을 구성합니다.

4. **클러스터 정보 업데이트**:
  - 클러스터 정보를 업데이트합니다.

5. **Amazon ECR 로그인**:
  - Amazon ECR에 로그인합니다.

6. **Docker 이미지 빌드 및 푸시**:
  - CRM 서비스 및 배치 서비스용 Docker 이미지를 빌드하고 Amazon ECR로 푸시합니다.

7. **Kubernetes에 서비스 적용 및 배포 재시작**:
  - CRM 서비스 및 이벤트 서비스와 배치 서비스를 Kubernetes에 적용하고 배포를 재시작합니다.

## 권한 및 보안:
- CI/CD 파이프라인의 접근 제어 및 보안 정책을 기술합니다.
    - 접근 제어: IAM
    - 보안 정책: 쿠버네티스 시크릿을 이용한 데이터 암호화, 보안 그룹 설정


## 문서화 :
- CI/CD 계획서 
    - 문서화: GitHub Readme 작성


</br>

<details>
<summary> <h1> 배포 결과 테스트 </h1> </summary>

## S3 버킷 생성

<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/fa1de006-2083-48a1-ba58-e41f68ca5e5d" height="80%" width="80%">

</br>

## 버킷 정책 편집
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/f479ab42-a2f5-48af-bfcd-e676132daae4" height="80%" width="80%">

</br>

## Cloud Front 생성
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/2fee512d-0609-4765-85f5-5ea502d7c8af" height="80%" width="80%">

</br>

## Cloud Front에 적용할 SSL 인증서 생성

<img height="80%" width="80%" src="https://github.com/Catch-team/Catch-BE/assets/122894395/f096f15f-1d73-4482-a125-e2f49be9e77c">
<img height="80%" width="80%" src="https://github.com/Catch-team/Catch-BE/assets/122894395/e323d9f6-0384-42c5-9e02-0d0d72c96576">
<img height="80%" width="80%" src="https://github.com/Catch-team/Catch-BE/assets/122894395/c76584b5-a42f-41ab-8e27-d2458d0ede88">
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/763dbcc4-3d03-4766-818e-bf0de7eda16a" height="80%" width="80%">



</br>

## Route53에서 호스팅 영역 생성
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/ad5ac0db-d054-4869-a399-614b12121977" height="80%" width="80%">

- 가비아에서 등록한 도메인의 ns 레코드 값을 생성된 호스팅 영역의 ns 레코드 값을 수정

<img src="https://github.com/Catch-team/Catch-BE/assets/122894395/59ac6833-4903-4d10-9d9a-c13ac458517f" height="80%" width="80%">

</br>

## 프론트 레코드 생성

- cloudfront의 엔드포인트 설정
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/5512f162-3e1a-4074-9f00-8b7905579895" height="80%" width="80%">

</br>

## CloudFront의 DNS 세팅
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/221d4d74-7952-4666-8bfb-a66d3f5dd87b" height="80%" width="80%">

</br>

## frontend git action
<details>
<summary> - frontend_depoly.yml </summary>
  
```
name: Deploy to AWS S3

on:
  push:
    branches:
    - dev

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: setup node.js
      uses: actions/setup-node@v2
      with:
        node-version: '20'

    - run: |
        echo "VUE_APP_FIREBASE_API_KEY=${{secrets.API_KEY}}" >> .env
        echo "VUE_APP_FIREBASE_AUTH_DOMAIN=${{secrets.DOMAIN}}" >> .env
        echo "VUE_APP_FIREBASE_PROJECT_ID=${{secrets.PROJECT_ID}}" >> .env
        echo "VUE_APP_FIREBASE_STORAGE_BUCKET=${{secrets.BUCKET}}" >> .env
        echo "VUE_APP_FIREBASE_MESSAGING_SENDER_ID=${{secrets.SENDER_ID}}" >> .env
        echo "VUE_APP_FIREBASE_APP_ID=${{secrets.APP_ID}}" >> .env
        echo "VUE_APP_FIREBASE_MEASUREMENTID=${{secrets.MEASUREMENT_ID}}" >> .env
        echo "VUE_APP_FIREBASE_VAP_ID=${{secrets.VAP_ID}}" >> .env
    - run: cat .env
    
    - name: npm install
      working-directory: ./
      run: npm install

    - name: npm firebase install
      working-directory: ./
      run: npm install firebase

    - name: npm run build
      working-directory: ./
      run: npm run build

    - name: setup aws cli
      uses: aws-actions/configure-aws-credentials@v2
      with: 
        aws-access-key-id: ${{secrets.AWS_S3_ACCESS_KEY}}
        aws-secret-access-key: ${{secrets.AWS_S3_SECRET_KEY}}
        aws-region: "ap-northeast-2"

    - name: deploy to s3
      run: |
        aws s3 cp ./dist s3://catchteam/ --recursive

```

</details>
</br>

## RDS 생성
<img height="80%" width="80%" src="https://github.com/Catch-team/Catch-BE/assets/122894395/e92d8a1f-b47d-4bd9-acf0-b95598e3c1e4">
<img height="80%" width="80%" src="https://github.com/Catch-team/Catch-BE/assets/122894395/b886fc70-9909-4f41-991c-f3061a85d42a">
<img height="80%" width="80%" src="https://github.com/Catch-team/Catch-BE/assets/122894395/d697076a-aa57-42da-9bde-0f504f138b59">
<img height="80%" width="80%"src="https://github.com/Catch-team/Catch-BE/assets/122894395/678b510a-da71-4cde-8bb7-265ae8e6dfab">

## RDS 파라미터 그룹 설정
- 파라미터 그룹을 설정해주지 않으면 DB에 한글을 넣을때 에러 발생

<img height="80%" width="80%" src="https://github.com/Catch-team/Catch-BE/assets/122894395/ab9a4eec-dac9-4c1f-b52c-5be9cb274d05">
<img height="80%" width="80%" src="https://github.com/Catch-team/Catch-BE/assets/122894395/c6cf80bc-8623-4ef5-99b0-efc1d490ae8a">
<img height="80%" width="80%" src="https://github.com/Catch-team/Catch-BE/assets/122894395/c06eb74b-1642-4035-a5d6-7c5c1255f561">

- char 검색시 나오는 항목들 utf8mb4

<img height="80%" width="80%" src="https://github.com/Catch-team/Catch-BE/assets/122894395/a08a8fb9-80b0-4f66-8669-f588f2aee708">

- collation 검색시 나오는 항목들 utf8mb4_general_ci
  
<img height="80%" width="80%" src="https://github.com/Catch-team/Catch-BE/assets/122894395/b981d82a-c195-45eb-91be-b6fcfcbec7e3">


## EKS 클러스터 생성
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/530fdbe7-065a-447f-aa5c-a4b7a62c773b" height="80%" width="80%">

</br>

## 클러스터 서비스 역할 EKS로 설정
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/088be74e-dc23-40cc-a73c-e5024f67a4c6" height="80%" width="80%">

<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/d6304e70-97fa-49b1-9387-4705640a2d35" height="80%" width="80%">


</br>

## 클러스터 이름 생성
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/a0f687f7-29ff-44f3-973a-f41ab4b185be" height="80%" width="80%">

<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/3a57cdc6-0b3e-4aad-a56a-ff9793635c20" height="80%" width="80%">

</br>

## EKS 보안그룹 설정
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/e3f8df2e-f885-466d-8854-40d945c25b8e" height="80%" width="80%">

</br>

## EKS 생성
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/1d366f8d-5618-4173-badb-8050c7f5e88a" height="80%" width="80%">

</br>

## 노드그룹 생성
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/0cf3ee88-8089-49f4-9f7e-ae0b9f2ee969" height="80%" width="80%">

</br>

## 노드그룹 IAM 역할 설정
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/7a948627-1280-4c59-bdca-10d8f2f0fd9c" height="80%" width="80%">

- IAM 역할 EC2 부여
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/cf738812-40e9-464b-b2a4-c346e864da7c" height="80%" width="80%">

- IAM 역할 EKS 권한 부여 
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/e0dadefd-6cca-418d-82dc-7d3865fd593a" height="80%" width="80%">

</br>

## 노드그룹 스펙 설정
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/5815c561-8569-4bf4-b1f6-fa2fbe5a5d87" height="80%" width="80%">

</br>

## 노드그룹 크기 설정
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/9bfd65fa-d89f-48b2-8af1-3b6f5c584e5a" height="80%" width="80%">

</br>

## 노드그룹 생성 완료
<img src="https://github.com/Catch-team/Catch-BE/assets/78871184/c3f5c062-f2b5-4315-a0cd-27299d70e80a" height="80%" width="80%">

</br>

## cert manager 설정
1. 터미널을 킵니다.

2. aws cli 설치 및 aws configure 설정

- aws cli 설치
https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/getting-started-install.html

- aws configure 설정

```
aws configure
> AWS Access Key ID: aws 액세스 키 입력
> AWS Secret Access Key: aws 비밀 액세스 키 입력
> Default region name: region name 입력
> Default output format: output format 입력
```

3. kubectl 설치
- mac 
```
brew install kubectl
```
- 윈도우

```
winget install -e --id Kubernetes.kubectl
```

4. 설치 확인
```
kubectl version --client
```

5. 클러스터 설정
aws에서 클러스터 생성 후
```
aws eks update-kubeconfig --region ap-northeast-2 --name catch-cluster
```

6. cert-manager 생성
```
kubectl create namespace cert-manager
```

7. Helm 설치
```
helm repo add jetstack [https://charts.jetstack.io](https://charts.jetstack.io/)
helm repo update
helm install cert-manager jetstack/cert-manager --namespace cert-manager --version v1.5.0 --create-namespace --set installCRDs=true
// ingress_cert 파일이 있는곳으로 이동
cd ./k8s
```
<details>
<summary> - ingress_cert.yml</summary>
  
```
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    # 인증서 서버 주소. 해당 서버의 리소스를 통해 인증서 발행
    server: https://acme-v02.api.letsencrypt.org/directory
    # 인증서 만료 또는 갱신 필요시 알람 email
    email: s99s4481@gmail.com
    privateKeySecretRef:
      name: letsencrypt-prod
    solvers:
      - http01:
          ingress:
            class: nginx
---
# ClusterIssue를 사용하여 Certificate 리소스 생성 : Certificate리소스 생성시에 인증서 발급
apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: catch-com-tls
  namespace: default
spec:
  secretName: catch-com-tls
  duration: 2160h #90days
  renewBefore: 360h #before 15day
  issuerRef:
    name: letsencrypt-prod
    kind: ClusterIssuer
  commonName: server.catch-crm.shop
  dnsNames:
    - server.catch-crm.shop
```

</details>
</br>

8. ingress aplly

```
kubectl apply -f ingress_cert.yml
kubectl get certificate
// 문제가 있다면 지우고 다시 시도
kubectl delete -f ingress_cert.yml
```

</br>

## nginx ingress controller 설정
```
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.1.1/deploy/static/provider/cloud/deploy.yaml
```
</br>

## ingress HOSTS 확인
<img width="1003" alt="328369541-f508d7ec-e55f-4412-8ce2-78c5ae88e060" src="https://github.com/Catch-team/Catch-BE/assets/122894395/2fd351ad-4848-4356-be61-d56b345cf45f">

## route53에 cname으로 생성된 로드밸런서 dns 넣기
<img src="https://github.com/Catch-team/Catch-BE/assets/122894395/6c790e4c-2e91-40fd-8544-2b5bd992dd3b" height="80%" width="80%">

## elastiCache (redis) 생성
<img src="https://github.com/Catch-team/Catch-BE/assets/122894395/1add8025-9183-4bd6-9a23-725121a3f2ba" height="80%" width="80%">
<img src="https://github.com/Catch-team/Catch-BE/assets/122894395/6e83de84-7cff-40fe-93ec-31a0bc960940" height="80%" width="80%">
<img src="https://github.com/Catch-team/Catch-BE/assets/122894395/7a968350-9997-46c4-bfc5-754e138ca607" height="80%" width="80%">
<img src="https://github.com/Catch-team/Catch-BE/assets/122894395/f7e30150-4ca7-4ea3-8369-dda53b1f6f51" height="80%" width="80%">

## k8s secret 설정
```
kubectl create secret generic db-infos \
--from-literal=DB_HOST= DB_HOST\
--from-literal=DB_USERNAME= DB_USERNAME \
--from-literal=DB_PASSWORD= DB_PASSWORD \
--from-literal=REDIS_HOST= REDIS_HOST \
--from-literal=GOOGLE_EMAIL= GOOGLE_EMAIL \
--from-literal=GOOGLE_SMTP= GOOGLE_SMTP \
--from-literal=JWT_SECRETKEY= JWT_SECRETKEY \
--from-literal=SYMMETRICKEY= SYMMETRICKEY \
--from-literal=FIREBASE_JSON= FIREBASE_JSON \
```

## backend git action
<details>
<summary> - backend_depoly.yml </summary>
  
```
name: deploy Catch-Backend
on:
  push:
    branches:
      - dev
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: checkout github
        uses: actions/checkout@v2
      - name: install kubectl
        uses: azure/setup-kubectl@v3
        with:
          version: "v1.25.9"
        id: install
      - name: configure aws #aws configure 팀 키값
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }} # 추가 해줘야함
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }} # 추가 해줘야함
          aws-region: ap-northeast-2
      - name: update cluster information
        run: aws eks update-kubeconfig --name catch-cluster --region ap-northeast-2
      - name: Login to ECR
        id: login-ecr
        uses: aws-actions/amazon-ecr-login@v1

      ################ build and push #################
      - name: create-json
        uses: jsdaniell/create-json@v1.2.3
        with:
          name: "catch-push-firebase-adminsdk-x6w7k-bded31fa6b.json"
          json: ${{ secrets.FIREBASE_JSON }}
          dir: './crm/src/main/resources/'

      - name: build and push docker image to ecr (catch-crm)
        env:
          REGISTRY: 533267078155.dkr.ecr.ap-northeast-2.amazonaws.com # ECR주소
          REPOSITORY: catch-crm
          IMAGE_TAG: latest
        run: |
          docker build \
          -t $REGISTRY/$REPOSITORY:$IMAGE_TAG \
          -f ./crm/Dockerfile ./crm
          docker push $REGISTRY/$REPOSITORY:$IMAGE_TAG
      - name: build and push docker image to ecr (catch-batch)
        env:
          REGISTRY: 533267078155.dkr.ecr.ap-northeast-2.amazonaws.com # ECR주소
          REPOSITORY: catch-batch
          IMAGE_TAG: latest
        run: |
          docker build \
          -t $REGISTRY/$REPOSITORY:$IMAGE_TAG \
          -f ./batch/Dockerfile ./batch
          docker push $REGISTRY/$REPOSITORY:$IMAGE_TAG

      ################ apply ################
      - name: eks kubectl crm apply
        run: |
          kubectl apply -f ./crm/k8s/catch-crm-serv.yml
          kubectl rollout restart deployment crm
      - name: eks kubectl batch apply
        run: |
          kubectl apply -f ./batch/k8s/catch-batch-serv.yml
          kubectl rollout restart deployment batch

```

</details>
</br>

</details> -->
